# ---------------------------------------------------
# Mihomo 多订阅 + 防重名 + 负载均衡配置
# ---------------------------------------------------

mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
ipv6: false

external-controller: :9090
external-ui: ui
secret: ""

# ---------------------------------------------------
# 1. 代理集合 (多订阅设置)
# ---------------------------------------------------
proxy-providers:
  # === 订阅 1 ===
  Provider_Main:
    type: http
    url: "https://你的第1个订阅链接"
    interval: 3600
    path: ./proxies/sub1.yaml
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
    # 【关键逻辑】防重名：给该订阅所有节点名加上前缀
    override:
      prefix: "[主订阅] "

  # === 订阅 2 ===
  Provider_Backup:
    type: http
    url: "https://你的第2个订阅链接"
    interval: 3600
    path: ./proxies/sub2.yaml
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204
    # 【关键逻辑】防重名：给该订阅所有节点名加上前缀
    override:
      prefix: "[备用] "

# ---------------------------------------------------
# 2. 策略组
# ---------------------------------------------------
proxy-groups:
  # [入口组] 手动选择模式
  - name: "节点选择"
    type: select
    proxies:
      - "负载均衡"
      - "自动选择"
      - DIRECT
    # 引入所有订阅
    use:
      - Provider_Main
      - Provider_Backup

  # [功能组] 负载均衡 (混合所有订阅的节点)
  - name: "负载均衡"
    type: load-balance
    strategy: consistent-hashing
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    tolerance: 150
    # 引入所有订阅，让它们一起参与负载
    use:
      - Provider_Main
      - Provider_Backup

  # [功能组] 自动测速 (从所有订阅中选最快的)
  - name: "自动选择"
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    tolerance: 50
    use:
      - Provider_Main
      - Provider_Backup

# ---------------------------------------------------
# 3. 规则
# ---------------------------------------------------
rules:
  - GEOIP,LAN,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,节点选择
